# Это первое домашнее задание в курсе Архитектура компьютерных систем на 2-ом курсе ОП "Программная инженерия" в НИУ ВШЭ. 2021-2022

## Описание задания.
В ходе выполнения задания необходимо написать программу, которая должна быть оформлена в виде консольного приложения, удовлетворяющего следующим требованиям:
1. Запуск программы осуществляется из командной строки, в которой указываются: имя запускаемой программы; имя файла с исходными данными; имя файла с выходными данными.
2. Для каждого программного объекта, загружаемого в контейнер (на основе массива максимальной размерности), исходный файл с тестовым набором должен содержать, признак альтернативы, а также список параметров, необходимых этой альтернативе. Этот список должен быть представлен в формате, удобном для обработки компьютером. При больших данных во входном файле должны быть указаны только параметры для генератора случайных наборов данных, который и заполняет контейнер.
3. В выходной файл необходимо вывести введенные в контейнер данные. Помимо этого необходимо вывести информацию об общем количестве объектов, содержащихся в контейнере. После этого в тот же файл необходимо вывести новые данные в соответствии с результатами, полученными в ходе работы программы. Информация для вывода должна быть представлена в форме, удобной для восприятия пользователем.
4. Программа должна иметь модульную структуру, соответствующую выданному варианту задания.
5. Для   представления   символьных   данных,   обрабатываемых   в   программе предлагается использовать только латиницу. Это обусловлено стремлением упростить их обработку. Дело в том, что в Linux в качестве основной кодировки символов принята UTF-8, которая за пределами кодировки ASCII использует двухбайтовый формат, в том числе и для русских букв. Комментарии, пояснительный текст, не требующий обработки можно писать  с использованием как русского, так и английского языков, а также транлитом.

**Вариант задания: 21**

---------

## Начальное условие задачи
| Обобщённый артефакт| Базовые альтрнативы | Общие для всех алтернитив перменные | Общие для всех альтернитив функции |
| :---: | :--- | :--- | --- |
| Фильмы | 1. Игровой<br> 2. Мультфильмы <br> 3. Документальный | 1. Название фильма<br> 2. Год выхода | Частное от деления года выхода фильма на на количество сиволов в названии фильма.

---

## Обработка данных в контейнере
Упорядочить элементы контейнера по возрастанию используя сортировку _Сортировка с помощью прямого выбора_ (_Straight Selection_). В качестве ключей для сортировки и других действий используются результаты функции, общей для всех альтернатив.

----

## Сборка полученной программы.
```
cmake -B <build_dir> -DCMAKE_BUILD_TYPE=Release
cmake --build <build_dir> --target main
```
Исполняемы файл программы будет расположен в папке `bin`.

---

## Тестирование
Исходные данные для тестирования содержатся в каталоге `tests/data`.

Файл с результатами прогонов тестов `tests/report.txt`.

Для запуска поставляемых с решением тестов есть заготовленный скрипт `run-script.sh`.
Данный скрипт принимает единственный аргумент командной: имя исполняемого файла.
Такой агументы необходим, т.к. пользователь, который собирает проект может использовать разные компиляторы, в зависимости от чего путь до исполняемого файла в папке `bin` пожет содержать в себе подпапки папки `bin` (например компилятор MSVC в случае дебажной сборки использует такой путь до исполняемого файла: `bin/Debug/main.exe`).

Пример использования скрипта в случае компилятора GCC в ОС Linux.
```
./run-script.sh bin/main
```

Примеры использования программы без тестирующего скрипта. Предполагается, что сейчас мы в корне проекта. Использовался компилятор GCC в ОС Linux
```
# Parse input file with data
./bin/main tests/data/test_001.txt tests/test_001.out
# Parse input file with random generator setup for the test
./bin/main -n 100 tests/data/test_random_004.txt tests/test_004.out
```

Время работы программы на разных размерах входных данных:
Количество фильмов | Время работы, seconds | Потребляемая память, KB
--- | --- | ---
7 | < 0.01 | ~3600
100 | < 0.01 | ~3800
1000 | 0.01 | ~3800
5000 | 0.14 | ~4150
10000 | 1.10 | ~4700

---

## Метрики, определяющие характеристики программы:
| Метрика | Значение |
| :---: | --- |
| Число интерфейсных модулей | 6 |
| Число модулей с реализацией | 5 + 1 (файл, тестирующий работу библиотеки) |
| Общий размер исходных текстов программы | 19.551 KB |
| Размер исполняемого файла релизной сборки (GCC, Linux)__*__ | 30.368 KB |

__*__ Версии подробнее:
```
$ g++ --version
g++ (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0
Copyright (C) 2019 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

$ lsb_release -a
Distributor ID: Ubuntu
Description:    Ubuntu 20.04.2 LTS
Release:        20.04
Codename:       focal

$ uname -a
Linux DESKTOP-641N9G3 5.10.16.3-microsoft-standard-WSL2 #1 SMP Fri Apr 2 22:23:49 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux
```

## Описание структуры вычислительной системы:
### Размеры фундаментальных типов на машине amd64:
Тип | Размер в байтах
:--- | ---:
bool | 1
char | 1
int | 4
unsigned | 4
double | 8
enum class | 4
void* | 8
uint32_t | 4

### Используемые структуры данных:
```
struct Cartoon {  // size: 4
    enum Class Type {  // size 4
        kHandDrawnCartoon,
        kPuppetCartoon,
        kClayCartoon
    };

    Type type;  // size: 4, offset: 0
};
```

```
struct Fiction { // size: 8
    char* director;  // size: 8, offset: 0
};
```

```
struct Documentary { // size: 4
    uint32_t duration;  // size: 4, offset: 0
};
```

```
struct Film {  // size: 48
    std::string name;  // size: 32, offset: 0
    uint32_t release_year;  // size: 4, offset: 32

    enum class Type { // size: 4
        kCartoon,
        kFiction,
        kDocumentary
    };
    Type type;  // size: 4, offset: 36

    union {  // size: 8, offset: 40
        Cartoon,        // size: 4, offset: 40
        Fiction,        // size: 8, offset: 40
        Documentary     // size: 4, offset: 40
    };
}
```

```
enum class DeserializationError : int {  // size: 4
    kSuccess = 0,
    kIOError = 1,
    kContainerToLittle = 2,
    kMalformedData = 3
};
```

```
namespace detail {
    static constexpr size_t kMaxElementsInContainer = 10000;  // size: 8
}

struct Container {  // size: 80 008
    Film* films[detail::kMaxElementsInContainer];  // size: 8 * 10000 = 80 000
    size_t size;  // size: 8
};
```

### Память процесса:
__main(argc, argv)__:
Имя переменной | Смещение в стэке | Размер | Куда указывает (для переменных типа указатель)
:--- | --- | --- | ---
int argc | 0 | 4
char** argv | 4 | 8 | Указаель указывает на память, где расположены аргументы командной строки. На машине, на которой проводится тестирование, указатель указывает на память аллоцированную на стеке.
std::ifstream input_file | 8 | 520
std::ofstream output_file | 528 | 512
Container container | 1030 | 80008 | Каждый из инициализированных указателей массива `container.films` указывает на данные в HEAP (инициализируеются указатели после вызовов `Deserialize` или `Generate`). Сам указатель `container.films` указывает на массив аллоцированный на стеке.
Initialize |  | 8
DeserializationError error_code | 81038 | 4
Deserialize | | 8
FatalError | | 8
PrintUsage | | 8
size_t number | 81038 | 8
InitRandomizerSetup | | 8
Generate | | 8
SelectionSort | | 8
Serialize | | 8

Глобальная память:
```
" [-n <number_of_elements>] <input_file> <output_file>\n"  // size: 56
"Incorrect argumens. Number must be in range [1, 10000] but it is equal to "  // size: 75
"Failed to read file."  // size: 21
"Container cannot contain so many elements."  // size: 43
"Malformed input"  // size: 16
"-n"  // size: 3
```
