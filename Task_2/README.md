# Это второе домашнее задание в курсе Архитектура компьютерных систем на 2-ом курсе ОП "Программная инженерия" в НИУ ВШЭ. 2021-2022

## Описание задания.
В ходе выполнения задания необходимо написать программу, которая должна быть оформлена в виде консольного приложения, удовлетворяющего следующим требованиям:
1. Запуск программы осуществляется из командной строки, в которой указываются: имя запускаемой программы; имя файла с исходными данными; имя файла с выходными данными.
2. Для каждого программного объекта, загружаемого в контейнер (на основе массива максимальной размерности), исходный файл с тестовым набором должен содержать, признак альтернативы, а также список параметров, необходимых этой альтернативе. Этот список должен быть представлен в формате, удобном для обработки компьютером. При больших данных во входном файле должны быть указаны только параметры для генератора случайных наборов данных, который и заполняет контейнер.
3. В выходной файл необходимо вывести введенные в контейнер данные. Помимо этого необходимо вывести информацию об общем количестве объектов, содержащихся в контейнере. После этого в тот же файл необходимо вывести новые данные в соответствии с результатами, полученными в ходе работы программы. Информация для вывода должна быть представлена в форме, удобной для восприятия пользователем.
4. Программа должна иметь модульную структуру, соответствующую выданному варианту задания.
5. Для   представления   символьных   данных,   обрабатываемых   в   программе предлагается использовать только латиницу. Это обусловлено стремлением упростить их обработку. Дело в том, что в Linux в качестве основной кодировки символов принята UTF-8, которая за пределами кодировки ASCII использует двухбайтовый формат, в том числе и для русских букв. Комментарии, пояснительный текст, не требующий обработки можно писать  с использованием как русского, так и английского языков, а также транлитом.

**Вариант задания: 21**

---------

## Начальное условие задачи
| Обобщённый артефакт| Базовые альтрнативы | Общие для всех алтернитив перменные | Общие для всех альтернитив функции |
| :---: | :--- | :--- | --- |
| Фильмы | 1. Игровой<br> 2. Мультфильмы <br> 3. Документальный | 1. Название фильма<br> 2. Год выхода | Частное от деления года выхода фильма на на количество сиволов в названии фильма.

---

## Обработка данных в контейнере
Упорядочить элементы контейнера по возрастанию используя сортировку _Сортировка с помощью прямого выбора_ (_Straight Selection_). В качестве ключей для сортировки и других действий используются результаты функции, общей для всех альтернатив.

----

## Сборка полученной программы.
```
cmake -B <build_dir> -DCMAKE_BUILD_TYPE=Release
cmake --build <build_dir> --target task_2
```
Исполняемы файл программы будет расположен в папке `bin`.

---

## Тестирование
Исходные данные для тестирования содержатся в каталоге `tests/data`.

Файл с результатами прогонов тестов `tests/report.txt`.

Для запуска поставляемых с решением тестов есть заготовленный скрипт `run-script.sh`.
Данный скрипт принимает единственный аргумент командной: имя исполняемого файла.
Такой агументы необходим, т.к. пользователь, который собирает проект может использовать разные компиляторы, в зависимости от чего путь до исполняемого файла в папке `bin` пожет содержать в себе подпапки папки `bin` (например компилятор MSVC в случае дебажной сборки использует такой путь до исполняемого файла: `bin/Debug/task_2.exe`).

Пример использования скрипта в случае компилятора GCC в ОС Linux.
```
./run-script.sh bin/task_2
```

Примеры использования программы без тестирующего скрипта. Предполагается, что сейчас мы в корне проекта. Использовался компилятор GCC в ОС Linux
```
# Parse input file with data
./bin/task_2 tests/data/test_001.txt tests/test_001.out
# Parse input file with random generator setup for the test
./bin/task_2 -n 100 tests/data/test_random_004.txt tests/test_004.out
```

Время работы программы на разных размерах входных данных:
Количество фильмов | Время работы, seconds | Потребляемая память, KB
--- | --- | ---
7 | < 0.01 | ~3500
100 | < 0.01 | ~3500
1000 | 0.01 | ~3700
5000 | 0.11 | ~4000
10000 | 0.43 | ~4400

---

## Метрики, определяющие характеристики программы:
| Метрика | Значение |
| :---: | --- |
| Число интерфейсных модулей | 8 |
| Число модулей с реализацией | 8 |
| Общий размер исходных текстов программы | 8.954 KB |
| Размер исполняемого файла релизной сборки (GCC, Linux)__*__ | 45.984 KB |

__*__ Версии подробнее:
```
$ g++ --version
g++ (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0
Copyright (C) 2019 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

$ lsb_release -a
Distributor ID: Ubuntu
Description:    Ubuntu 20.04.2 LTS
Release:        20.04
Codename:       focal

$ uname -a
Linux DESKTOP-641N9G3 5.10.16.3-microsoft-standard-WSL2 #1 SMP Fri Apr 2 22:23:49 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux
```

## Описание структуры вычислительной системы:
### Размеры фундаментальных типов на машине amd64:
Тип | Размер в байтах
:--- | ---:
bool | 1
char | 1
int | 4
unsigned | 4
double | 8
enum class | 4
void* | 8
uint32_t | 4

### Используемые структуры данных:
```
class Film {  // size: 48
    /* implicitly added vptr */ // size: 8, offset: 0
    std::string m_name;  // size: 32, offset: 8
    uint32_t m_release_year; // size: 4, offset: 40
    /* pad bytes */ // size: 4, offset: 44
}
```

```
class Cartoon : public Film {  // size: 48
    enum Class Type {  // size 4
        kHandDrawnCartoon,
        kPuppetCartoon,
        kClayCartoon
    };

    /* implicitly added vptr */ // size: 8, offset: 0
    std::string Film::m_name; // size: 32, offset: 8
    uint32_t Film::m_release_year; // size: 4, offset: 40
    Type m_type;  // size: 4, offset: 44
};
```

```
class Fiction : public Film {  // size: 80

    /* implicitly added vptr */ // size: 8, offset: 0
    std::string Film::m_name; // size: 32, offset: 8
    uint32_t Film::m_release_year; // size: 4, offset: 40
    /* pad bytes */ // size: 4, offset: 44
    std::string m_director;  // size: 32, offset: 48
};
```

```
class Documentary : public Film {  // size: 48
    /* implicitly added vptr */ // size: 8, offset: 0
    std::string Film::m_name; // size: 32, offset: 8
    uint32_t Film::m_release_year; // size: 4, offset: 40
    uint32_t m_duration;  // size: 4, offset: 44
};
```

```
class Container {  // size: 24
    static constexpr size_t kMaxElementsInContainer = 10000;  // size: 8, static memory
    std::vector<std::unique_ptr<Film>> m_films;  // size: 24, offset: 0
};
```

```
class FilmGenerator {  // size: 5000
    std::mt19937 m_random; // size: 5000, offset: 0
};
```

### Память процесса:
__main(argc, argv)__:
Имя переменной | Смещение в стэке | Размер | Куда указывает (для переменных типа указатель)
:--- | --- | --- | ---
int argc | 0 | 4
char** argv | 4 | 8 | Указаель указывает на память, где расположены аргументы командной строки. На машине, на которой проводится тестирование, указатель указывает на память аллоцированную на стеке.
std::ifstream input_file | 8 | 520
std::ofstream output_file | 528 | 512
Container container | 1030 | 24 |
size_t number | 1054 | 8

__GenerateFilms(container, film_count, random_seed)__:
Имя переменной | Смещение в стэке | Размер | Куда указывает (для переменных типа указатель)
:--- | --- | --- | ---
Container& container | 0 | 8
size_t film_count | 8 | 8
uint32_t random_seed | 16 | 4
size_t i | 20 | 8
FilmGenerator generator | 28 | 5000


__FatalError(const char* error)__:
Имя переменной | Смещение в стэке | Размер | Куда указывает (для переменных типа указатель)
:--- | --- | --- | ---
const char* error | 0 | 8 | Все вызовы FatalError делаются из фукнции main, в качестве аргумента всегда передаётся строка, аллоцированная в сегменте данных, т.е. указатель указывает на память в куче.

Глобальная память:
```
" [-n <number_of_elements>] <input_file> <output_file>\n"  // size: 55
"Incorrect argumens. Number must be in range [1, "  // size: 49
"] but it is equal to "  // 22
"Failed to read file."  // size: 21
"Container cannot contain so many elements."  // size: 43
"Malformed container data"  // size: 16
"Cannot open input file"  // 23
"Cannot open output file"  // 23
"Malformed randomizer configuration"  // 35
"-n"  // size: 3
"Failed to write to file"  // 24
```
